<script type="text/javascript">
//<!--
	$('#perso_pa').html("<?php echo $PA;?>");
	$('#perso_cash').html("<?php echo $CASH;?>");
	
	//Fonction generales

	showplzwait = function(){
		$('#plzwait1').show();
		$('#plzwait2').show();
		$('#request_msgtxt').html("Veuillez patienter...");
		$('#request_msg').hide();
	}
	hideplzwait = function(){
		$('#plzwait1').hide();
		$('#plzwait2').hide();
	}



	//Retrait
	operation_retrait = function(id){
		showplzwait();
		$.ajax({
                    url:'?popup=1&m=Action_Lieu_BanqueRetrait',
                    method: 'post',
                    data: 'id='+id+'&montant='+$('#o_montant'+id).val(), 
                    dataType: "html",
                    success: function (data) {
                        operation_confirm(data);
                    }
                });
	}
	
	//Depot
	operation_depot = function(id){
		showplzwait();
		
                $.ajax({
                    url:'?popup=1&m=Action_Lieu_BanqueDepot',
                    method: 'post',
                    data: 'id='+id+'&montant='+$('#o_montant'+id).val(), 
                    dataType: "html",
                    success: function (data) {
                        operation_confirm(data);
                    }
                });
	}
	
	//Transfert
	operation_transfert = function(id){
		showplzwait();
		
                $.ajax({
                    url:'?popup=1&m=Action_Lieu_BanqueTransfert',
                    method: 'post',
                    data: 'id='+id+'&montant='+$('#t_montant'+id).val()+'&compte='+$('#t_compte'+id).val(), 
                    dataType: "html",
                    success: function (data) {
                        operation_confirm(data);
                    }
                });
	}
	
	
	operation_confirm = function(rval){
		
		var params=rval.split("|");
		
		if (params[1]=="OK"){
			$('#cash'+params[0]).html(params[2]);
			$('#perso_cash').html(params[3]);
			$('#perso_pa').html(params[4]);
			
			hideplzwait();
		}else{
			$('#request_msg').show();
			$('#request_msgtxt').html(params[1]);
		}
	}
	
	goTo = function(cptid, url) {
		var theForm = $('#action_redirect'+cptid);
		
		theForm.action = url;
		ajaxSubmitForm(theForm);
	}
//-->
</script>
<!-- Zone ombragée -->
<div id="plzwait1" class="plzwait_ombre">&nbsp;</div>
<div id="plzwait2" class="plzwait_content">
	<table style="margin:0 auto;width:300px;height:150px;">
		<tr><td class="title" style="height:10px;">Traitement de la demande</td>
		<tr>
		<td class="name">
			<div id="request_msgtxt">Veuillez patienter...</div>
			<div id="request_msg" style="display:none;text-align:center;"><br /><a href="#" onclick="hideplzwait();">- Fermer -</a></div>
		</td>
		</tr>
	</tr>
	</table>
</div>






<br />
<table class="tbl_center">
	<tr>
		<td class="title" colspan="2">
			Banque <?php echo $BANQUE->getNom();?>
		</td>
	</tr>
	<?php
	foreach($BANK_ACCOUNTS as $account){
	?>
		<tr><td class="title" colspan="2">
			Compte: <?php echo $account->getNoBanque();?>-<?php echo $account->getNoCompte();?> au nom de <?php echo $account->getNom();?>.<br />
			<?php
			if (!$BANQUE->canRetrait()){
			?>
				(compte pour d&eacute;pot uniquement)<br />
			<?php
			}
			?>
		</td></tr>
		<tr>
			<td class="value" colspan="2">
				<form id="action_redirect<?php echo $account->getId();?>" method="post" action="">
					<input type="hidden" name="compte" id="compte" value="<?php echo $account->getNoBanque();?>-<?php echo $account->getNoCompte();?>" />
				</form>
				[<span class="fakelink" onclick="goTo('<?php echo $account->getId();?>','?popup=1&m=Action_Lieu_BanqueCarte');">Gestion des cartes de guichet</span>]
				[<span class="fakelink" onclick="goTo('<?php echo $account->getId();?>','?popup=1&m=Action_Lieu_BanqueHistorique');">Relev&eacute; des transactions</span>]
				<?php if($account->authAutoTransactions()){?>
					[<span class="fakelink" onclick="goTo('<?php echo $account->getId();?>','?popup=1&m=Action_Lieu_BanqueTransactionAuto');">Gestion des transactions automatiques</span>]
				<?php }?>
			</td>
		</tr>
		<tr>
			<td class="name" style="width:50%;">D&eacute;pot/Retrait</td>
			<td class="name" style="width:50%;">Transfert</td>
		</tr>
		<tr>
			<td class="value">
				<table>
					<tr>
						<td class="name">Solde du compte:</td>
						<td class="valeur"><span id="cash<?php echo $account->getId();?>"><?php echo ($account->getCash() != -1)? $account->getCash() . GAME_DEVISE : 'illimité';?></td>
					</tr>
					<tr>
						<td class="name">Montant de la transaction:</td>
						<td class="value"><input type="text" class="text" id="o_montant<?php echo $account->getId();?>" value="0" size="6" maxlength="12" /><?php echo GAME_DEVISE;?></td>
					</tr>
					<tr>
						<td class="name">Type de transaction:</td>
						<td class="value">
							<?php
							//if (!isset($BANK_VIA_ITEM)){
							?>
								<input type="button" class="button" name="depot" value="D&eacute;pot" onclick="operation_depot(<?php echo $account->getId();?>);" />
							<?php
							//}
							if($BANQUE->canRetrait()){
							?>
								<input type="button" class="button" name="retrait" value="Retrait" onclick="operation_retrait(<?php echo $account->getId();?>);" />
							<?php
							}
							?>
						</td>
					</tr>
				</table>
			</td>
			<td class="value">
				<table>
					<tr>
						<td class="name">Verser dans le compte #:</td>
						<td class="value"><input type="text" class="text" id="t_compte<?php echo $account->getId();?>" value="" size="19" maxlength="19" /></td>
					</tr>
					<tr>
						<td class="name">Montant de la transaction:</td>
						<td class="value"><input type="text" class="text" id="t_montant<?php echo $account->getId();?>" value="0" size="6" maxlength="12" /><?php echo GAME_DEVISE;?></td>
					</tr>
						<td class="name">Type de transaction:</td>
						<td class="value">
							<?php
							if ($BANQUE->canRetrait()){
							?>
								<input type="button" class="button" name="transfert" value="Transfert" onclick="operation_transfert(<?php echo $account->getId();?>);" />
							<?php
							}
							else
							{
							?>
							<i>- Ceci n'est pas un compte autorisant les opérations banquaires -</i>
							<?php
							}
							?>
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td class="value" colspan="2">
				<form id="action_bank_nip<?php echo $account->getId();?>" method="post" action="?popup=1&m=Action_Lieu_Banque" onsubmit="return ajaxSubmitForm(this);">
					<input type="hidden" name="compte_id" value="<?php echo $account->getId();?>" />
					NIP : <input type="text" class="text" name="nip" size="5" maxlength="5" value="<?php echo $account->getNip();?>" />
					<input type="submit" name="changeNIP" class="button" value="Changer" />
				</form>
				<br />
				<form id="action_bank_close<?php echo $account->getId();?>" method="post" action="?popup=1&m=Action_Lieu_Banque" onsubmit="return ajaxSubmitForm(this);">
					<input type="hidden" name="compte_id" value="<?php echo $account->getId();?>" />
					<input type="checkbox" name="c_check" value="checked" />Je d&eacute;sire fermer ce compte.<br />
					<input type="submit" name="close" class="button" style="width:200px;" value="Fermer ce compte maintenant" onclick="return confirm('Fermer ce compte ?');" />
				</form>
			</td>
		</tr>
		<?php
	}
	?>
</table>

	
<table class="tbl_center">
<tr><td class="send" colspan="2">
<br />
<form id="action_bank_open" method="post" action="?popup=1&m=Action_Lieu_BanqueCompteAdd" onsubmit="return ajaxSubmitForm(this);">
	<input type="submit" name="newaccount" class="button" style="width:200px;" value="Ouvrir un nouveau compte" />
</form>
</td></tr>
</table>

