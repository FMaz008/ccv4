<script type="text/javascript">
//<!--
	validate = function(){
		
		var re;
		
		re = new RegExp("^[A-Za-z0-9\\.-_]+$");
		if (!$('#url').val().match(re)) {
			alert("L'URL comporte des caract&egrave;res invalide.");
			return false;
		}
		
			
		
		//Requête AJAX pour valider le # de carte + NIP
		showplzwait();
		$.ajax({
                    url: '?popup=1&m=Action_Item_Sitemod',
                    method: 'post',
                    data: 'url=<?php echo $SITE->getUrl();?>'+
                            '&new_url='+$('#url').val()+
                            '&accueil='+$('#accueil').val()+
                            '&user='+$('#header_user').val()+
                            '&pass='+$('#header_pass').val()+
                            '&acces='+$('#acces').val()+
                            '&titre='+$('#titre').val(), 
                    dataType: "html",
                    success: function (data) {
                        operation_confirm(data);
                    }
                });
		return false;
	}

	//Fonction générales

	showplzwait = function(){
		$('#plzwait1').show();
		$('#plzwait2').show();
		$('#request_msgtxt').html("Veuillez patienter...");
		$('#request_msg').hide();
	}
	hideplzwait = function(){
		$('#plzwait1').hide();
		$('#plzwait2').hide();
	}
	operation_confirm = function(rval){
		
		var params=rval.split("|");
		
		if (params[0]=="OK"){
			hideplzwait();
			$('#perso_pa').html(params[1]);
			goTo(params[2]);
		}else{
			$('#request_msg').show();
			$('#request_msgtxt').html(decodeURIComponent(params[1]));
		}
	}
//-->
</script>
<!-- Zone ombragée -->
<div id="plzwait1" class="plzwait_ombre">&nbsp;</div>
<div id="plzwait2" class="plzwait_content">
	<table style="margin:0 auto;width:300px;height:150px;">
		<tr><td class="title" style="height:10px;">Traitement de la demande</td>
		<tr>
		<td class="name">
			<div id="request_msgtxt">Veuillez patienter...</div>
			<div id="request_msg" style="display:none;text-align:center;"><br /><a href="#" onclick="hideplzwait();">- Fermer -</a></div>
		</td>
		</tr>
	</tr>
	</table>
</div>



<form id="action_navigateurDomnetModsite" method="post" action="" onsubmit="return ajaxSubmitForm(this);">

	<center>
		<strong>Modifier le site</strong>
	</center>
	<br />
	<table class="tbl_center">
	<tr>
		<td class="name">URL</td>
	</tr>
	<tr>
		<td class="value">
			<input type="text" class="text" name="url" size="50" maxlength="250" id="url" value="<?php echo $SITE->getUrl();?>" />
		</td>
	</tr>
	<tr>
		<td class="name">Titre</td>
	</tr>
	<tr>
		<td class="value">
			<input type="text" class="text" name="titre" size="50" maxlength="250" id="titre" value="<?php echo $SITE->getTitre();?>" />
		</td>
	</tr>
	<tr>
		<td class="name">Acc&egrave;s</td>
	</tr>
	<tr>
		<td class="value">
			<input type="radio" class="text" name="acces" id="acces" value="pub" <?php echo (($SITE->isPublic()) ? 'CHECKED' : ''); ?> /> Public
			<input type="radio" class="text" name="acces" id="acces" value="priv"<?php echo (($SITE->isPublic()) ? '' : 'CHECKED'); ?> /> Priv&eacute;
		</td>
	</tr>
	<tr>
		<td class="name">Page d'accueil</td>
	</tr>
	<tr>
		<td class="value">
			<select name="accueil" id="accueil">
				<option value="0" <?php if ($SITE->getFirstPageId()==0){ echo 'SELECTED '; } ?>>aucune</option>
				<?php
				foreach($PAGES as $page)
				{
					?>
					<option value="<?php echo $page->getId();?>" <?php if ($SITE->getFirstPageId()==$page->getId()){ echo 'SELECTED '; } ?>><?php echo $page->getId();?> - <?php echo $page->getTitre();?></option>
					<?php
				}
				?>
			</select>
		</td>
	</tr>
	</table>
	
	<input type="button" class="button" name="create" value="Enregistrer les modifications !" onclick="validate();" />
</form>
