<script type="text/javascript">
//<!--
	
	
	//Fonction AJAX générales
	function fail(){
		$('#request_msg').show();
		$('#request_msgtxt').html("La requête à échouée, veuillez ré-essayer plus tard.");
	}
	
	function showplzwait(){
		$('#plzwait1').show();
		$('#plzwait2').show();
		$('#request_msgtxt').html("Veuillez patienter...");
		$('#request_msg').hide();
	}
	function hideplzwait(){
		$('#plzwait1').hide();
		$('#plzwait2').hide();
	}





	function fct_step1(who){
		if(who=="me"){
			$('#panel_searchUser').hide();
			$('#userId').val('<?php echo $ACCOUNT_ID;?>');
			$('#userName').val('<?php echo $ACCOUNT_USER;?>');
			$('#userMp').val('<?php echo $MP_LVL;?>');
		}else{
			$('#panel_searchUser').show(); //.css({ display: 'inline' }); //incertain si show() fonctionnera bien.
			$('#userId').val('');
			$('#userName').val('');
			$('#userMp').val('');
		}
	}
	
	function fct_searchUser(){
	
		//Requête AJAX pour valider si l'utilisateur existe
		showplzwait();
                $.ajax({
                    url:'?popup=1&m=Mp_ConfirmUser',
                    method: 'post',
                    data: 'user='+$('#panel_userName').val(), 
                    dataType: "html",
                    success: function (data) {
                        operation_confirm(data);
                    }
                });
	}
	
	function fct_changerSearch(){
		$('#panel_searchUser').show(); //.css({ display: 'inline' }); //incertain si show() fonctionnera bien.
		$('#panel_foundUser').hide();
		$('#userId').val('');
		$('#userName').val('');
	}
	
	function operation_confirm(rval){
	
		var params=rval.split("|");
		
		if (params[0]=="OK"){
			hideplzwait();
			$('#userId').val(decodeURIComponent(params[1]));
			$('#userName').val(decodeURIComponent(params[2]));
			$('#panel_searchUser').hide();
			$('#panel_foundUser').show(); //.css({ display: 'inline' }); //incertain si show() fonctionnera bien.
			$('#panel_foundUserName').html($('#userName').val());
		}else{
			$('#userId').val('');
			$('#userName').val('');
			$('#request_msg').show();
			$('#request_msgtxt').html(params[1]);
		}
	}
	
	
	function validate(){
		if($('#userId').val() == ''){
			alert("Vous devez spécifier un utilisateur valide.");
			return false;
		}
		return true;
	}

//-->
</script>
<!-- Zone ombragée -->
<div id="plzwait1" class="plzwait_ombre">&nbsp;</div>
<div id="plzwait2" class="plzwait_content">
	<table style="margin:0 auto;width:300px;height:150px;">
		<tr><td class="title" style="height:10px;">Traitement de la demande</td>
		<tr>
		<td class="name">
			<div id="request_msgtxt">Veuillez patienter...</div>
			<div id="request_msg" style="text-align:center;"></div>
			<div style="text-align:center;"><br /><a href="#form" onclick="hideplzwait();">- Fermer -</a></div>
		</td>
		</tr>
	</tr>
	</table>
</div>






<?php if(false){?>

<hr />
<table id="abo_progress">
	<tr>
		<td class="name">
			Étape 1
			<br /><i>Sélectionner le compte</i>
		</td>
		<td class="sep">&rarr;</td>
		<td class="value">
			Étape 2
			<br /><i>Choisir le forfait</i>
		</td>
		<td class="sep">&rarr;</td>
		<td class="value">
			Étape 3
			<br /><i>Passer à la caisse</i>
		</td>
	</tr>
</table>
<hr />

<br />
<br />
<div style="width:100%;">
	<form name="myform" id="myform" onsubmit="return false;">
		<strong>Abonnement concernant :</strong>
		<br /><input type="radio" name="who" value="me" onclick="fct_step1(this.value);" CHECKED /> Ce compte (<?php echo $ACCOUNT_USER;?>)
		<br /><input type="radio" name="who" value="friend" onclick="fct_step1(this.value);" /> Un ami
	</form>
</div>

<br />
<br />
<div id="panel_searchUser" style="display:none;">
	<form onsubmit="return false;">
		<strong>Identifier l'utilisateur à abonner.</strong>
		<br />Nom d'utilisateur: <input type="text" class="text" id="panel_userName" value="" />
		<input type="submit" class="button" name="valid_user" value="Valider" onclick="fct_searchUser($('#panel_userName').val());" />
	</form>
</div>
<div id="panel_foundUser" style="display:none;">
	<strong>Identifier l'utilisateur à abonner.</strong>
	<br /><span id="panel_foundUserName" style="font-style:italic;"></span> trouvé.
	<a href="#" onclick="fct_changerSearch();">Changer</a>
</div>

<br />
<br />
<div style="text-align:right;width:100%;">
	<form name="myform" method="post" action="?m=Mp_Abo2" onsubmit="return validate();">
		<input type="hidden" name="userId" id="userId" value="<?php echo $ACCOUNT_ID;?>" />
		<input type="hidden" name="userName" id="userName" value="<?php echo $ACCOUNT_USER;?>" />
		<input type="hidden" name="userMp" id="userMp" value="<?php echo $MP_LVL;?>" />
		<input type="submit" class="button" name="next" value="Suivant >>" />
	</form>
</div>
<?php }?>
Page obsolète !
